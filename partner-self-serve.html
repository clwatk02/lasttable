<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Partner Self-Serve — Last Table</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/assets/css/custom.css">
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body class="bg-blacklux text-offwhite">
  <div class="max-w-6xl mx-auto px-4 py-10">
    <div id="gate" class="glass p-6 rounded-3xl border text-center">
      <h1 class="display text-3xl font-semibold">Partner Self-Serve</h1>
      <p class="opacity-80">Restaurants can propose late windows here. Login required.</p>
      <button id="login" class="btn-primary mt-4">Log in</button>
    </div>
    <div id="panel" class="hidden">
      <div class="glass p-6 rounded-3xl border">
        <h2 class="font-semibold text-xl">Propose Late Windows</h2>
        <p class="opacity-80 text-sm">Submitting this form notifies the admin (and optionally emails your confirmation if EmailJS is configured in Settings).</p>
        <form id="late-form" class="grid md:grid-cols-4 gap-3 mt-3" action="https://formsubmit.co/YOUR_EMAIL@EXAMPLE.COM" method="POST" data-apps-script="">
          <input type="hidden" name="_subject" value="Last Table — Late Window Proposal">
          <input type="hidden" name="_captcha" value="false">
          <div class="md:col-span-2"><label class="block text-sm mb-1">Restaurant ID</label><input name="restaurant_id" class="w-full px-3 py-2 rounded-xl text-black outline-none" placeholder="exact id from admin"/></div>
          <div><label class="block text-sm mb-1">Date</label><input type="date" name="date" class="w-full px-3 py-2 rounded-xl text-black outline-none"/></div>
          <div><label class="block text-sm mb-1">Time Window</label><input name="window" placeholder="e.g., 9–10 PM" class="w-full px-3 py-2 rounded-xl text-black outline-none"/></div>
          <div class="md:col-span-4"><label class="block text-sm mb-1">Notes</label><input name="notes" class="w-full px-3 py-2 rounded-xl text-black outline-none" placeholder="caps, table mix, conditions"/></div>
          <button class="btn-primary md:col-span-4" type="submit">Submit window</button>
        </form>
      </div>
      <div class="glass p-6 rounded-3xl border mt-6">
        <h2 class="font-semibold text-xl">Update Your Listing</h2>
        <p class="opacity-80 text-sm">Open the admin entry for your restaurant to update details.</p>
        <div id="links" class="mt-3 text-sm"></div>
      </div>
    </div>
  </div>
  <script>
    const id = window.netlifyIdentity;
    const gate=document.getElementById('gate'), panel=document.getElementById('panel');
    function upd(u){ if(u){ gate.classList.add('hidden'); panel.classList.remove('hidden'); boot(); } else { panel.classList.add('hidden'); gate.classList.remove('hidden'); } }
    if(id){ id.on('init', upd); id.on('login', upd); id.on('logout', ()=>upd(null)); }
    document.getElementById('login').onclick=()=>id && id.open('login');

    async function boot(){
      const data = await (await fetch('/content/restaurants.json',{cache:'no-store'})).json();
      const links = document.getElementById('links');
      const list = (data.restaurants||[]);
      links.innerHTML = list.map(r=>{
        return '<div class="mb-2"><span class="opacity-70">'+r.name+'</span> — <a class="underline" href="/admin/#/collections/restaurants/entries/'+r.id+'" target="_blank">Edit</a></div>';
      }).join('');
    }
  </script>
  <script src="/assets/js/forms.js"></script>
  <script src="/assets/js/settings.js"></script>
</body>
</html>
